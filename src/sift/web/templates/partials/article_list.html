<div class="article-list-wrap" data-selected-article="{{ selected_article_id or '' }}">
  <header class="article-list-header">
    <strong>{{ article_list.total }} articles</strong>
    <div class="article-list-header-right">
      <span class="muted">{{ query.sort }} · {{ query.state }}</span>
      <div class="bulk-actions">
        <form class="inline-form" hx-post="/web/actions/article/bulk-state" hx-target="#article-list" hx-swap="innerHTML">
          <input type="hidden" name="scope_type" value="{{ query.scope_type }}" />
          <input type="hidden" name="scope_id" value="{{ query.scope_id or '' }}" />
          <input type="hidden" name="state" value="{{ query.state }}" />
          <input type="hidden" name="sort" value="{{ query.sort }}" />
          <input type="hidden" name="q" value="{{ query.q or '' }}" />
          <input type="hidden" name="limit" value="{{ query.limit }}" />
          <input type="hidden" name="offset" value="{{ query.offset }}" />
          <input type="hidden" name="article_id" value="{{ selected_article_id or '' }}" />
          <input type="hidden" name="article_ids" value="" data-bulk-ids />
          <input type="hidden" name="is_read" value="true" />
          <button type="submit" class="state-btn-text" data-requires-selection>Read</button>
        </form>
        <form class="inline-form" hx-post="/web/actions/article/bulk-state" hx-target="#article-list" hx-swap="innerHTML">
          <input type="hidden" name="scope_type" value="{{ query.scope_type }}" />
          <input type="hidden" name="scope_id" value="{{ query.scope_id or '' }}" />
          <input type="hidden" name="state" value="{{ query.state }}" />
          <input type="hidden" name="sort" value="{{ query.sort }}" />
          <input type="hidden" name="q" value="{{ query.q or '' }}" />
          <input type="hidden" name="limit" value="{{ query.limit }}" />
          <input type="hidden" name="offset" value="{{ query.offset }}" />
          <input type="hidden" name="article_id" value="{{ selected_article_id or '' }}" />
          <input type="hidden" name="article_ids" value="" data-bulk-ids />
          <input type="hidden" name="is_read" value="false" />
          <button type="submit" class="state-btn-text" data-requires-selection>Unread</button>
        </form>
        <form class="inline-form" hx-post="/web/actions/article/bulk-state" hx-target="#article-list" hx-swap="innerHTML">
          <input type="hidden" name="scope_type" value="{{ query.scope_type }}" />
          <input type="hidden" name="scope_id" value="{{ query.scope_id or '' }}" />
          <input type="hidden" name="state" value="{{ query.state }}" />
          <input type="hidden" name="sort" value="{{ query.sort }}" />
          <input type="hidden" name="q" value="{{ query.q or '' }}" />
          <input type="hidden" name="limit" value="{{ query.limit }}" />
          <input type="hidden" name="offset" value="{{ query.offset }}" />
          <input type="hidden" name="article_id" value="{{ selected_article_id or '' }}" />
          <input type="hidden" name="article_ids" value="" data-bulk-ids />
          <input type="hidden" name="is_starred" value="true" />
          <button type="submit" class="state-btn-text" data-requires-selection>Save</button>
        </form>
      </div>
    </div>
  </header>
  <ul class="article-list">
    {% for item in article_list.items %}
      <li class="article-row {% if selected_article_id and selected_article_id == item.id %}selected{% endif %}" data-article-row data-article-id="{{ item.id }}">
        <div class="row-leading">
          <input
            type="checkbox"
            class="row-check"
            data-select-article
            value="{{ item.id }}"
            aria-label="Select article"
          />
          <form
            hx-patch="/web/actions/article/{{ item.id }}/state"
            hx-target="#article-list"
            hx-swap="innerHTML"
            class="inline-form"
          >
            <input type="hidden" name="scope_type" value="{{ query.scope_type }}" />
            <input type="hidden" name="scope_id" value="{{ query.scope_id or '' }}" />
            <input type="hidden" name="state" value="{{ query.state }}" />
            <input type="hidden" name="sort" value="{{ query.sort }}" />
            <input type="hidden" name="q" value="{{ query.q or '' }}" />
            <input type="hidden" name="limit" value="{{ query.limit }}" />
            <input type="hidden" name="offset" value="{{ query.offset }}" />
            <input type="hidden" name="article_id" value="{{ selected_article_id or '' }}" />
            <input type="hidden" name="is_read" value="{{ 'false' if item.is_read else 'true' }}" />
            <button type="submit" class="state-btn" data-action="toggle-read" title="Toggle read">
              {{ '●' if not item.is_read else '○' }}
            </button>
          </form>
        </div>
        <a
          class="row-main"
          href="/app?scope_type={{ query.scope_type }}{% if query.scope_id %}&scope_id={{ query.scope_id }}{% endif %}&state={{ query.state }}&sort={{ query.sort }}&q={{ query.q or '' }}&article_id={{ item.id }}"
          hx-get="/web/partials/article-reader/{{ item.id }}?scope_type={{ query.scope_type }}{% if query.scope_id %}&scope_id={{ query.scope_id }}{% endif %}&state={{ query.state }}&sort={{ query.sort }}&q={{ query.q or '' }}"
          hx-target="#article-reader"
          hx-swap="innerHTML"
          hx-push-url="true"
        >
          <span class="article-title">{{ item.title }}</span>
          <span class="article-meta">{{ item.feed_title or "Unknown feed" }} · {{ item.published_at or item.created_at }}</span>
        </a>
        <div class="row-actions">
          <form
            hx-patch="/web/actions/article/{{ item.id }}/state"
            hx-target="#article-list"
            hx-swap="innerHTML"
            class="inline-form"
          >
            <input type="hidden" name="scope_type" value="{{ query.scope_type }}" />
            <input type="hidden" name="scope_id" value="{{ query.scope_id or '' }}" />
            <input type="hidden" name="state" value="{{ query.state }}" />
            <input type="hidden" name="sort" value="{{ query.sort }}" />
            <input type="hidden" name="q" value="{{ query.q or '' }}" />
            <input type="hidden" name="limit" value="{{ query.limit }}" />
            <input type="hidden" name="offset" value="{{ query.offset }}" />
            <input type="hidden" name="article_id" value="{{ selected_article_id or '' }}" />
            <input type="hidden" name="is_starred" value="{{ 'false' if item.is_starred else 'true' }}" />
            <button type="submit" class="state-btn" data-action="toggle-star" title="Toggle saved">
              {{ '★' if item.is_starred else '☆' }}
            </button>
          </form>
        </div>
      </li>
    {% else %}
      <li class="empty-state">No articles for this scope.</li>
    {% endfor %}
  </ul>
</div>
